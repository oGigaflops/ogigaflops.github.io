<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TAG</title>
    <link rel="stylesheet" href="style.css">
    <script>
        // Add a global error event listener early on in the page load, to help ensure that browsers
        // which don't support specific functionality still end up displaying a meaningful message.
        window.addEventListener('error', function (error) {
            if (ChromeSamples && ChromeSamples.setStatus) {
                console.error(error);
                ChromeSamples.setStatus(error.message + ' (Your browser may not support this feature.)');
                error.preventDefault();
            }
        });
    </script>
</head>
<body>
    <h3 class="title">TAGs</h3>
    <div class="container">
        <div class="form">
            <input type="text" id="ref" placeholder="referência">
            <input type="text" id="design" placeholder="designação">
            <input type="text" id="stock" placeholder="stock">
        </div>
        <button id="scanButton"><span>LER</span></button>
        
    </div>

    <script>

    scanButton.addEventListener("click", async () => {
        
        try {
        const ndef = new NDEFReader();
        await ndef.scan();
        document.getElementById("ref").value = "Rastreio iniciado";
        document.getElementById("design").value = "";
        document.getElementById("stock").value = "";
        
        ndef.addEventListener("readingerror", () => {
            document.getElementById("ref").value = "Erro lendo tag";
            document.getElementById("design").value = "";
            document.getElementById("stock").value = "";
        });

        ndef.addEventListener("reading", ({ message, serialNumber }) => {

            get(serialNumber);

    });

        } catch (error) {
            document.getElementById("ref").value = "Error reading data from NFC: " + error;
        }

    });
    
    function get(serialNumber) {
        fetch('http://84.232.22.142:8000/service.php?id=' + serialNumber)
        .then(response => response.json())
        .then(data => {
            document.getElementById("ref").value = data.ref;
            document.getElementById("design").value = data.design;
            document.getElementById("stock").value = data.stock;
        })
        .catch(error => {
            document.getElementById("ref").value = "Error fetching data from server: " + error;
        });
    }

    </script>

</body>
</html>