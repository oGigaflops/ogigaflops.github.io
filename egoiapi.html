<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    body {
      background-color: rgb(49, 49, 49);
      color: rgb(32, 32, 32);
    }
  </style>
  <title>E-goi API Teste</title>
</head>

<body>
  <br>
  <div id="container" class="container-md w-75 m-auto bg-light rounded d-flex justify-content-sm-center flex-column">
  
    <select id="lista" class="form-control w-50 align-self-center mt-5" size="3">
      <option>Item 1</option>
      <option>Item 2</option>
      <option>Item 3</option>
    </select>
    <br>
    <button class="btn btn-primary p-2 w-50 align-self-center mb-5" onclick="createCampaign(lista.selectedIndex)">SMS</button>
  </div>



  <script>

    function alerta(idx) {
      var lista = document.getElementById('lista');
      alert(lista.options[idx].text);
    }

    function createCampaign(idx) {
      var lista = document.getElementById('lista');
      var msg = lista.options[idx].text;
      console.log(msg);

      fetch('https://api.egoiapp.com/campaigns/sms', {
        method: 'POST',
        body: JSON.stringify({
          'list_id': '21',
          'internal_name': 'CT',
          'content': {
            'type': 'text',
            'message': `${msg}`
          },
          'sender_id': '7',
          'options': {
            'encoding': 'gsm_extended',
            'max_messages': '7'
          },
        }),
        headers: {
          'Content-type': 'application/json',
          'Apikey': '1c3debeeacd51a441fe873b4a7a847b45fde90da',
          'credentials': 'include',
          'X-Frame-Options': 'SAMEORIGIN',
          'Access-Control-Allow-Origin': '*',
          'Access-Control-Allow-Headers': '*',
        }
      }).then(function (response) {
        return response.json().then(function (data) {
          console.log(data);
          sendSMS(data.campaign_hash);
        }).catch(function (error) {
          console.log(error);
        });
      });
    };

    function updateCampaign(hash, msg) {

      fetch(`https://api.egoiapp.com/campaigns/sms/${hash}`, {
        method: 'PATCH',
        body: JSON.stringify({
          'internal_name':'CT',
          'content':{'message':`${msg}`},
          'sender_id':'7',
          'options':{'encoding':'gsm_extended',
                    'max_messages':'7'
          },
        }),
        headers: {
          'Content-type': 'application/json',
          'Apikey': '1c3debeeacd51a441fe873b4a7a847b45fde90da',
          'credentials': 'include',
          'X-Frame-Options': 'SAMEORIGIN',
          'Access-Control-Allow-Origin': '*',
          'Access-Control-Allow-Headers': '*',
        }
      }).then(function (response) {
        return response.json().then(function (data) {
          console.log(data);
          sendSMS(hash);
        }).catch(function (error) {
          console.log(error);
        });
      });
    };

    function sendSMS(hash) {


      fetch(`https://api.egoiapp.com/campaigns/sms/${hash}/actions/send`, {
        method: 'POST',
        body: JSON.stringify({
          'list_id': '21',
          'destination_field': 'cellphone',
          'segments': { 'type': 'none' }
        }),
        headers: {
          'Content-type': 'application/json',
          'Apikey': '1c3debeeacd51a441fe873b4a7a847b45fde90da',
          'credentials': 'include',
          'X-Frame-Options': 'SAMEORIGIN',
          'Access-Control-Allow-Origin': '*',
          'Access-Control-Allow-Headers': '*'
        }
      }).then(function (response) {
        return response.json().then(function (data) {
          console.log(data);
        }).catch(function (error) {
          console.log(error);
        })
      });

    };

  </script>
</body>

</html>